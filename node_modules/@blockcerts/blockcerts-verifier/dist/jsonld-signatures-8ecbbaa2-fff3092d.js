import{d as e,D as t,c as r,i as o}from"./main.js";import{a as n}from"./jsonld-6909fb49-1ef9cd75.js";var i,a,s=(function(e,t){!function(e,t){for(var r in t)e[r]=t[r]}(t,function(e){var t={};function r(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(o,n,function(t){return e[t]}.bind(null,n));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){
/*!
 * Copyright (c) 2021 Digital Bazaar, Inc. All rights reserved.
 */
const o=r(1),n=r(2),i=r(3),{CONTEXT_URL:a,SECURITY_CONTEXT_V1_URL:s,SECURITY_CONTEXT_V2_URL:c}=i,p=new Map;p.set(s,o),p.set(c,n),e.exports={constants:i,contexts:p,SECURITY_CONTEXT_V1_URL:s,SECURITY_CONTEXT_V2_URL:c,CONTEXT_URL:a,CONTEXT:n}},function(e,t,r){
/*!
 * Copyright (c) 2021 Digital Bazaar, Inc. All rights reserved.
 */
e.exports={"@context":{id:"@id",type:"@type",dc:"http://purl.org/dc/terms/",sec:"https://w3id.org/security#",xsd:"http://www.w3.org/2001/XMLSchema#",EcdsaKoblitzSignature2016:"sec:EcdsaKoblitzSignature2016",Ed25519Signature2018:"sec:Ed25519Signature2018",EncryptedMessage:"sec:EncryptedMessage",GraphSignature2012:"sec:GraphSignature2012",LinkedDataSignature2015:"sec:LinkedDataSignature2015",LinkedDataSignature2016:"sec:LinkedDataSignature2016",CryptographicKey:"sec:Key",authenticationTag:"sec:authenticationTag",canonicalizationAlgorithm:"sec:canonicalizationAlgorithm",cipherAlgorithm:"sec:cipherAlgorithm",cipherData:"sec:cipherData",cipherKey:"sec:cipherKey",created:{"@id":"dc:created","@type":"xsd:dateTime"},creator:{"@id":"dc:creator","@type":"@id"},digestAlgorithm:"sec:digestAlgorithm",digestValue:"sec:digestValue",domain:"sec:domain",encryptionKey:"sec:encryptionKey",expiration:{"@id":"sec:expiration","@type":"xsd:dateTime"},expires:{"@id":"sec:expiration","@type":"xsd:dateTime"},initializationVector:"sec:initializationVector",iterationCount:"sec:iterationCount",nonce:"sec:nonce",normalizationAlgorithm:"sec:normalizationAlgorithm",owner:{"@id":"sec:owner","@type":"@id"},password:"sec:password",privateKey:{"@id":"sec:privateKey","@type":"@id"},privateKeyPem:"sec:privateKeyPem",publicKey:{"@id":"sec:publicKey","@type":"@id"},publicKeyBase58:"sec:publicKeyBase58",publicKeyPem:"sec:publicKeyPem",publicKeyWif:"sec:publicKeyWif",publicKeyService:{"@id":"sec:publicKeyService","@type":"@id"},revoked:{"@id":"sec:revoked","@type":"xsd:dateTime"},salt:"sec:salt",signature:"sec:signature",signatureAlgorithm:"sec:signingAlgorithm",signatureValue:"sec:signatureValue"}}},function(e,t,r){
/*!
 * Copyright (c) 2021 Digital Bazaar, Inc. All rights reserved.
 */
e.exports={"@context":[{"@version":1.1},"https://w3id.org/security/v1",{AesKeyWrappingKey2019:"sec:AesKeyWrappingKey2019",DeleteKeyOperation:"sec:DeleteKeyOperation",DeriveSecretOperation:"sec:DeriveSecretOperation",EcdsaSecp256k1Signature2019:"sec:EcdsaSecp256k1Signature2019",EcdsaSecp256r1Signature2019:"sec:EcdsaSecp256r1Signature2019",EcdsaSecp256k1VerificationKey2019:"sec:EcdsaSecp256k1VerificationKey2019",EcdsaSecp256r1VerificationKey2019:"sec:EcdsaSecp256r1VerificationKey2019",Ed25519Signature2018:"sec:Ed25519Signature2018",Ed25519VerificationKey2018:"sec:Ed25519VerificationKey2018",EquihashProof2018:"sec:EquihashProof2018",ExportKeyOperation:"sec:ExportKeyOperation",GenerateKeyOperation:"sec:GenerateKeyOperation",KmsOperation:"sec:KmsOperation",RevokeKeyOperation:"sec:RevokeKeyOperation",RsaSignature2018:"sec:RsaSignature2018",RsaVerificationKey2018:"sec:RsaVerificationKey2018",Sha256HmacKey2019:"sec:Sha256HmacKey2019",SignOperation:"sec:SignOperation",UnwrapKeyOperation:"sec:UnwrapKeyOperation",VerifyOperation:"sec:VerifyOperation",WrapKeyOperation:"sec:WrapKeyOperation",X25519KeyAgreementKey2019:"sec:X25519KeyAgreementKey2019",allowedAction:"sec:allowedAction",assertionMethod:{"@id":"sec:assertionMethod","@type":"@id","@container":"@set"},authentication:{"@id":"sec:authenticationMethod","@type":"@id","@container":"@set"},capability:{"@id":"sec:capability","@type":"@id"},capabilityAction:"sec:capabilityAction",capabilityChain:{"@id":"sec:capabilityChain","@type":"@id","@container":"@list"},capabilityDelegation:{"@id":"sec:capabilityDelegationMethod","@type":"@id","@container":"@set"},capabilityInvocation:{"@id":"sec:capabilityInvocationMethod","@type":"@id","@container":"@set"},caveat:{"@id":"sec:caveat","@type":"@id","@container":"@set"},challenge:"sec:challenge",ciphertext:"sec:ciphertext",controller:{"@id":"sec:controller","@type":"@id"},delegator:{"@id":"sec:delegator","@type":"@id"},equihashParameterK:{"@id":"sec:equihashParameterK","@type":"xsd:integer"},equihashParameterN:{"@id":"sec:equihashParameterN","@type":"xsd:integer"},invocationTarget:{"@id":"sec:invocationTarget","@type":"@id"},invoker:{"@id":"sec:invoker","@type":"@id"},jws:"sec:jws",keyAgreement:{"@id":"sec:keyAgreementMethod","@type":"@id","@container":"@set"},kmsModule:{"@id":"sec:kmsModule"},parentCapability:{"@id":"sec:parentCapability","@type":"@id"},plaintext:"sec:plaintext",proof:{"@id":"sec:proof","@type":"@id","@container":"@graph"},proofPurpose:{"@id":"sec:proofPurpose","@type":"@vocab"},proofValue:"sec:proofValue",referenceId:"sec:referenceId",unwrappedKey:"sec:unwrappedKey",verificationMethod:{"@id":"sec:verificationMethod","@type":"@id"},verifyData:"sec:verifyData",wrappedKey:"sec:wrappedKey"}]}},function(e,t,r){
/*!
 * Copyright (c) 2021 Digital Bazaar, Inc. All rights reserved.
 */
e.exports={SECURITY_CONTEXT_V1_URL:"https://w3id.org/security/v1",SECURITY_CONTEXT_V2_URL:"https://w3id.org/security/v2",CONTEXT_URL:"https://w3id.org/security/v2"}}]))}(i={exports:{}},i.exports),i.exports),c=(a=s)&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a,p=s.contexts,d=s.constants,u=s.CONTEXT,f=s.CONTEXT_URL,l=s.SECURITY_CONTEXT_V1_URL,h=s.SECURITY_CONTEXT_V2_URL,m=t(Object.freeze({__proto__:null,CONTEXT:u,CONTEXT_URL:f,SECURITY_CONTEXT_V1_URL:l,SECURITY_CONTEXT_V2_URL:h,constants:d,contexts:p,default:c}));
/*!
 * Copyright (c) 2017-2023 Digital Bazaar, Inc. All rights reserved.
 */
const{constants:y}=m;var w={SECURITY_CONTEXT_URL:y.SECURITY_CONTEXT_V2_URL,SECURITY_CONTEXT_V1_URL:y.SECURITY_CONTEXT_V1_URL,SECURITY_CONTEXT_V2_URL:y.SECURITY_CONTEXT_V2_URL,SECURITY_PROOF_URL:"https://w3id.org/security#proof",SECURITY_SIGNATURE_URL:"https://w3id.org/security#signature"};
/*!
 * Copyright (c) 2017-2023 Digital Bazaar, Inc. All rights reserved.
 */const v=w,{contexts:g}=m;
/*!
 * Copyright (c) 2018-2021 Digital Bazaar, Inc. All rights reserved.
 */
const T=new Map([[v.SECURITY_CONTEXT_V1_URL,g.get(v.SECURITY_CONTEXT_V1_URL)],[v.SECURITY_CONTEXT_V2_URL,g.get(v.SECURITY_CONTEXT_V2_URL)]]),E={};var x=E;E.extendContextLoader=e=>async t=>{const r=T.get(t);return void 0!==r?{contextUrl:null,documentUrl:t,document:r,tag:"static"}:e(t)},E.strictDocumentLoader=E.extendContextLoader((e=>{throw new Error(`${e} not found.`)}));class b extends Error{constructor(e){super(b._prepareSuperMessage(e)),Object.defineProperty(this,"name",{value:"NonError",configurable:!0,writable:!0}),Error.captureStackTrace&&Error.captureStackTrace(this,b)}static _prepareSuperMessage(e){try{return JSON.stringify(e)}catch(t){return String(e)}}}const S=[{property:"name",enumerable:!1},{property:"message",enumerable:!1},{property:"stack",enumerable:!1},{property:"code",enumerable:!0}],L=Symbol(".toJSON called"),_=({from:e,seen:t,to_:n,forceEnumerable:i,maxDepth:a,depth:s})=>{const c=n||(Array.isArray(e)?[]:{});if(t.push(e),s>=a)return c;if("function"==typeof e.toJSON&&!0!==e[L])return(e=>{e[L]=!0;const t=e.toJSON();return delete e[L],t})(e);for(const[n,p]of Object.entries(e))"function"==typeof r&&o(p)?c[n]="[object Buffer]":"function"!=typeof p&&(p&&"object"==typeof p?t.includes(e[n])?c[n]="[Circular]":(s++,c[n]=_({from:e[n],seen:t.slice(),forceEnumerable:i,maxDepth:a,depth:s})):c[n]=p);for(const{property:t,enumerable:r}of S)"string"==typeof e[t]&&Object.defineProperty(c,t,{value:e[t],enumerable:!!i||r,configurable:!0,writable:!0});return c};var M={serializeError:(e,t={})=>{const{maxDepth:r=Number.POSITIVE_INFINITY}=t;return"object"==typeof e&&null!==e?_({from:e,seen:[],forceEnumerable:!0,maxDepth:r,depth:0}):"function"==typeof e?`[Function: ${e.name||"anonymous"}]`:e},deserializeError:(e,t={})=>{const{maxDepth:r=Number.POSITIVE_INFINITY}=t;if(e instanceof Error)return e;if("object"==typeof e&&null!==e&&!Array.isArray(e)){const t=new Error;return _({from:e,seen:[],to_:t,maxDepth:r,depth:0}),t}return new b(e)}};
/*!
 * Copyright (c) 2018-2022 Digital Bazaar, Inc. All rights reserved.
 */const C=w,O=n,{extendContextLoader:R,strictDocumentLoader:U}=x,{serializeError:D}=M;function K({document:e}){let t;t=O.getValues(e,"proof");const r=e["@context"]||C.SECURITY_CONTEXT_URL;return t=t.map((e=>({"@context":r,...e}))),t}function N(e){Object.defineProperty(e,"toJSON",{value:function(){return D(this)},configurable:!0,writable:!0})}var P=class extends Error{constructor(e){super("Verification error(s)."),this.name="VerificationError",this.errors=[].concat(e)}},A=class{constructor({type:e}={}){if("string"!=typeof e)throw new TypeError('A LinkedDataProof must have a "type".');this.type=e}async createProof({}){throw new Error('"createProof" must be implemented in a derived class.')}async derive({}){throw new Error('"deriveProof" must be implemented in a derived class.')}async verifyProof({}){throw new Error('"verifyProof" must be implemented in a derived class.')}async matchProof({proof:e}){return e.type===this.type}};
/*!
 * Copyright (c) 2018-2023 Digital Bazaar, Inc. All rights reserved.
 */const V={};var I=V;V.w3cDate=e=>{null==e?e=new Date:"number"!=typeof e&&"string"!=typeof e||(e=new Date(e));const t=e.toISOString();return t.substr(0,t.length-5)+"Z"},V.concat=(e,t)=>{const r=new Uint8Array(e.length+t.length);return r.set(e,0),r.set(t,e.length),r};const j=self&&(self.crypto||self.msCrypto);var k={async sha256digest({string:e}){const t=(new TextEncoder).encode(e);return new Uint8Array(await j.subtle.digest("SHA-256",t))}};
/*!
 * Copyright (c) 2017-2023 Digital Bazaar, Inc. All rights reserved.
 */const X=w,Y=n,z=I,{sha256digest:q}=k,$=A;
/*!
 * Copyright (c) 2018 Digital Bazaar, Inc. All rights reserved.
 */
const W={};var B=W;W.suites={LinkedDataProof:A,LinkedDataSignature:class extends ${constructor({type:e,proof:t,LDKeyClass:r,date:o,key:n,signer:i,verifier:a,useNativeCanonize:s,canonizeOptions:c,contextUrl:p}={}){super({type:e}),this.LDKeyClass=r,this.contextUrl=p,this.proof=t;const d=function({key:e,signer:t,verifier:r}){const o={};if(e){if(o.key=e,o.verificationMethod=e.id,"function"==typeof e.signer&&(o.signer=e.signer()),"function"==typeof e.verifier&&(o.verifier=e.verifier()),!o.signer&&!o.verifier)throw new TypeError('The "key" parameter must contain a "signer" or "verifier" method.')}else o.verificationMethod=t&&t.id||r&&r.id,o.signer=t,o.verifier=r;if(o.signer&&"function"!=typeof o.signer.sign)throw new TypeError("A signer API has not been specified.");if(o.verifier&&"function"!=typeof o.verifier.verify)throw new TypeError("A verifier API has not been specified.");return o}({key:n,signer:i,verifier:a});if(this.verificationMethod=d.verificationMethod,this.key=d.key,this.signer=d.signer,this.verifier=d.verifier,this.canonizeOptions=c,o&&(this.date=new Date(o),isNaN(this.date)))throw TypeError(`"date" "${o}" is not a valid date.`);this.useNativeCanonize=s,this._hashCache=null}async createProof({document:e,purpose:t,proofSet:r,documentLoader:o,expansionMap:n}){if(n)throw new Error('"expansionMap" not supported.');let i;i=this.proof?{...this.proof}:{},i.type=this.type;let a=this.date;void 0===i.created&&void 0===a&&(a=new Date),a&&"string"!=typeof a&&(a=z.w3cDate(a)),a&&(i.created=a),i.verificationMethod=this.verificationMethod,i=await this.updateProof({document:e,proof:i,proofSet:r,purpose:t,documentLoader:o}),i=await t.update(i,{document:e,suite:this,documentLoader:o});const s=await this.createVerifyData({document:e,proof:i,proofSet:r,documentLoader:o});return i=await this.sign({verifyData:s,document:e,proof:i,documentLoader:o}),i}async updateProof({proof:e,expansionMap:t}){if(t)throw new Error('"expansionMap" not supported.');return e}async verifyProof({proof:e,document:t,proofSet:r,documentLoader:o,expansionMap:n}){if(n)throw new Error('"expansionMap" not supported.');try{const i=await this.createVerifyData({document:t,proof:e,proofSet:r,documentLoader:o,expansionMap:n}),a=await this.getVerificationMethod({proof:e,document:t,documentLoader:o,expansionMap:n});if(!await this.verifySignature({verifyData:i,verificationMethod:a,document:t,proof:e,documentLoader:o,expansionMap:n}))throw new Error("Invalid signature.");return{verified:!0,verificationMethod:a}}catch(e){return{verified:!1,error:e}}}async canonize(e,{documentLoader:t,expansionMap:r,skipExpansion:o}){if(r)throw new Error('"expansionMap" not supported.');return Y.canonize(e,{algorithm:"URDNA2015",base:null,format:"application/n-quads",documentLoader:t,safe:!0,skipExpansion:o,useNative:this.useNativeCanonize,...this.canonizeOptions})}async canonizeProof(e,{document:t,documentLoader:r,expansionMap:o}){if(o)throw new Error('"expansionMap" not supported.');return delete(e={"@context":t["@context"]||X.SECURITY_CONTEXT_URL,...e}).jws,delete e.signatureValue,delete e.proofValue,this.canonize(e,{documentLoader:r,expansionMap:o,skipExpansion:!1,...this.canonizeOptions})}async createVerifyData({document:e,proof:t,documentLoader:r,expansionMap:o}){if(o)throw new Error('"expansionMap" not supported.');let n;const{_hashCache:i}=this;i&&i.document===e?n=i.hash:this._hashCache={document:e,hash:n=this.canonize(e,{documentLoader:r,expansionMap:o}).then((e=>q({string:e})))};const[a,s]=await Promise.all([this.canonizeProof(t,{document:e,documentLoader:r,expansionMap:o}).then((e=>q({string:e}))),n]);return z.concat(a,s)}async derive(){throw new Error("Must be implemented by a derived class.")}async getVerificationMethod({proof:e,documentLoader:t}){let{verificationMethod:r}=e;if("object"==typeof r&&(r=r.id),!r)throw new Error('No "verificationMethod" found in proof.');const o=await Y.frame(r,{"@context":X.SECURITY_CONTEXT_URL,"@embed":"@always",id:r},{documentLoader:t,compactToRelative:!1,safe:!0});if(!o)throw new Error(`Verification method ${r} not found.`);if(void 0!==o.revoked)throw new Error("The verification method has been revoked.");return o}async sign(){throw new Error("Must be implemented by a derived class.")}async verifySignature(){throw new Error("Must be implemented by a derived class.")}ensureSuiteContext({document:e,addSuiteContext:t}){const{contextUrl:r}=this;if(function({document:e,contextUrl:t}){const r=e["@context"];return r===t||Array.isArray(r)&&r.includes(t)}({document:e,contextUrl:r}))return;if(!t)throw new TypeError(`The document to be signed must contain this suite's @context, "${r}".`);const o=e["@context"]||[];e["@context"]=Array.isArray(o)?[...o,r]:[o,r]}}};
/*!
 * Copyright (c) 2018 Digital Bazaar, Inc. All rights reserved.
 */
var F=class{constructor({term:e,date:t,maxTimestampDelta:r=1/0}={}){if(void 0===e)throw new Error('"term" is required.');if(void 0!==r&&"number"!=typeof r)throw new TypeError('"maxTimestampDelta" must be a number.');if(this.term=e,void 0!==t&&(this.date=new Date(t),isNaN(this.date)))throw TypeError(`"date" "${t}" is not a valid date.`);this.maxTimestampDelta=r}async validate(e,{expansionMap:t}){if(t)throw new Error('"expansionMap" not supported.');try{if(this.maxTimestampDelta!==1/0){const t=(this.date||new Date).getTime(),r=1e3*this.maxTimestampDelta,o=new Date(e.created).getTime();if(!(o>=t-r&&o<=t+r))throw new Error("The proof's created timestamp is out of range.")}return{valid:!0}}catch(e){return{valid:!1,error:e}}}async update(e,{expansionMap:t}){if(t)throw new Error('"expansionMap" not supported.');return e.proofPurpose=this.term,e}async match(e,{expansionMap:t}){if(t)throw new Error('"expansionMap" not supported.');return e.proofPurpose===this.term}};
/*!
 * Copyright (c) 2018-2022 Digital Bazaar, Inc. All rights reserved.
 */const G=w,J=n,H=F,Q="https://www.w3.org/ns/did/v1",Z=["assertionMethod","authentication","capabilityInvocation","capabilityDelegation","keyAgreement","verificationMethod"];var ee=class extends H{constructor({term:e,controller:t,date:r,maxTimestampDelta:o=1/0}={}){if(super({term:e,date:r,maxTimestampDelta:o}),void 0!==t){if("object"!=typeof t)throw new TypeError('"controller" must be an object.');this.controller=t}this._termDefinedByDIDContext=Z.includes(e)}async validate(e,{verificationMethod:t,documentLoader:r,expansionMap:o}){try{const n=await super.validate(e,{verificationMethod:t,documentLoader:r,expansionMap:o});if(!n.valid)throw n.error;const{id:i}=t,{term:a,_termDefinedByDIDContext:s}=this;if(this.controller)n.controller=this.controller;else{const{controller:e}=t;let o;if(e)if("object"==typeof e)o=e.id;else{if("string"!=typeof e)throw new TypeError('"controller" must be a string representing a URL.');o=e}let{document:c}=await r(o);!(s&&c["@context"]===Q||Array.isArray(c["@context"])&&c["@context"][0]===Q)&&(c=await J.frame(c,{"@context":G.SECURITY_CONTEXT_URL,id:o,[a]:{"@embed":"@never",id:i}},{documentLoader:r,compactToRelative:!1,safe:!0})),n.controller=c}const c=J.getValues(n.controller,a);if(n.valid=c.some((e=>e===i||"object"==typeof e&&e.id===i)),!n.valid)throw new Error(`Verification method "${t.id}" not authorized by controller for proof purpose "${this.term}".`);return n}catch(e){return{valid:!1,error:e}}}};
/*!
 * Copyright (c) 2018 Digital Bazaar, Inc. All rights reserved.
 */const te=ee;
/*!
 * Copyright (c) 2018 Digital Bazaar, Inc. All rights reserved.
 */
const re=ee;
/*!
 * Copyright (c) 2018 Digital Bazaar, Inc. All rights reserved.
 */
const oe={};var ne=oe;oe.purposes={AssertionProofPurpose:class extends te{constructor({term:e="assertionMethod",controller:t,date:r,maxTimestampDelta:o=1/0}={}){super({term:e,controller:t,date:r,maxTimestampDelta:o})}},AuthenticationProofPurpose:class extends re{constructor({term:e="authentication",controller:t,challenge:r,date:o,domain:n,maxTimestampDelta:i=1/0}={}){if(super({term:e,controller:t,date:o,maxTimestampDelta:i}),"string"!=typeof r)throw new TypeError('"challenge" must be a string.');if(void 0!==n&&"string"!=typeof n)throw new TypeError('"domain" must be a string.');this.challenge=r,this.domain=n}async validate(e,{verificationMethod:t,documentLoader:r,expansionMap:o}){try{if(e.challenge!==this.challenge)throw new Error(`The challenge is not as expected; challenge="${e.challenge}", expected="${this.challenge}"`);if(void 0!==this.domain&&e.domain!==this.domain)throw new Error(`The domain is not as expected; domain="${e.domain}", expected="${this.domain}"`);return super.validate(e,{verificationMethod:t,documentLoader:r,expansionMap:o})}catch(e){return{valid:!1,error:e}}}async update(e,{document:t,suite:r,documentLoader:o,expansionMap:n}){return(e=await super.update(e,{document:t,suite:r,documentLoader:o,expansionMap:n})).challenge=this.challenge,void 0!==this.domain&&(e.domain=this.domain),e}},ControllerProofPurpose:ee,ProofPurpose:F};
/*!
 * Copyright (c) 2010-2023 Digital Bazaar, Inc. All rights reserved.
 */
const ie={};var ae=ie;const se=w;Object.assign(ie,se);const ce=class{async add(e,{suite:t,purpose:r,documentLoader:o}={}){if(!t)throw new TypeError('"options.suite" is required.');if(!r)throw new TypeError('"options.purpose" is required.');o=o?R(o):U;const n={...e};delete n.proof;const i=K({document:e}),a=await t.createProof({document:n,purpose:r,proofSet:i,documentLoader:o});return O.addValue(e,"proof",a),e}async derive(e,{suite:t,purpose:r,documentLoader:o}={}){if(!t)throw new TypeError('"options.suite" is required.');if(!r)throw new TypeError('"options.purpose" is required.');o=o?R(o):U;const n={...e};delete n.proof;const i=K({document:e});return await t.derive({document:n,purpose:r,proofSet:i,documentLoader:o})}async verify(e,{suite:t,purpose:r,documentLoader:o}={}){if(!t)throw new TypeError('"options.suite" is required.');if(!r)throw new TypeError('"options.purpose" is required.');const n=Array.isArray(t)?t:[t];if(0===n.length)throw new TypeError("At least one suite is required.");o=o?R(o):U;try{const t=K({document:e={...e}});if(0===t.length)throw new Error("No matching proofs found in the given document.");delete e.proof;const i=await async function({document:e,suites:t,proofSet:r,purpose:o,documentLoader:n}){const i=Array.isArray(o)?o:[o],a=new Map,s=new Map,c=new Map;if(await Promise.all(i.map((o=>async function({purposeToProofs:e,proofToSuite:t,purpose:r,proofSet:o,suites:n,suiteMatchQueue:i,document:a,documentLoader:s}){for(const c of o){if(!await r.match(c,{document:a,documentLoader:s}))continue;let o=!1;for(const e of n){let r=i.get(e);r||i.set(e,r=new Map);let n=r.get(c);if(n||(n=e.matchProof({proof:c,document:a,documentLoader:s}),r.set(c,n)),await n){o=!0,t.set(c,e);break}}if(o){const t=e.get(r);t?t.push(c):e.set(r,[c])}}}
/*!
 * Copyright (c) 2020 Digital Bazaar, Inc. All rights reserved.
 */({purposeToProofs:a,proofToSuite:s,purpose:o,proofSet:r,suites:t,suiteMatchQueue:c,document:e,documentLoader:n})))),a.size<i.length)return[];const p=new Map;return await Promise.all([...s.entries()].map((async([t,o])=>{let i;try{let a;const s={validate:async(e,{verificationMethod:t})=>(a=t,{valid:!0})},{verified:c,verificationMethod:p,error:d}=await o.verifyProof({proof:t,document:e,purpose:s,proofSet:r,documentLoader:n});a||(a=p),i={proof:t,verified:c,verificationMethod:a,error:d}}catch(e){i={proof:t,verified:!1,error:e}}i.error&&N(i.error),p.set(t,i)}))),await Promise.all([...a.entries()].map((async([t,r])=>{for(const o of r){const r=p.get(o);if(!r.verified)continue;const{verificationMethod:i}=r,a=s.get(o);let c;try{c=await t.validate(o,{document:e,suite:a,verificationMethod:i,documentLoader:n})}catch(e){c={valid:!1,error:e}}r.purposeResult?Array.isArray(r.purposeResult)?r.purposeResult.push(c):r.purposeResult=[r.purposeResult,c]:r.purposeResult=c,c.valid||(N(c.error),r.error||(r.verified=!1,r.error=c.error))}}))),[...p.values()]}({document:e,suites:n,proofSet:t,purpose:r,documentLoader:o});if(0===i.length){const e=new Error("Did not verify any proofs; insufficient proofs matched the acceptable suite(s) and required purpose(s).");throw e.name="NotFoundError",e}const a=i.some((e=>e.verified));if(!a){const e=[].concat(...i.filter((e=>e.error)).map((e=>e.error))),t={verified:a,results:i};return e.length>0&&(t.error=e),t}return{verified:a,results:i}}catch(e){return N(e),{verified:!1,error:e}}}},pe=P;ie.derive=async function(e,{suite:t,purpose:r,documentLoader:o,addSuiteContext:n=!0}={}){if("object"!=typeof e)throw new TypeError('The "document" parameter must be an object.');t.ensureSuiteContext({document:e,addSuiteContext:n});try{return await(new ce).derive(e,{suite:t,purpose:r,documentLoader:o})}catch(e){if(!o&&"jsonld.InvalidUrl"===e.name){const{details:{url:t}}=e,r=new Error(`A URL "${t}" could not be fetched; you need to pass "documentLoader" or resolve the URL before calling "derive".`);throw r.cause=e,r}throw e}},ie.sign=async function(e,{suite:t,purpose:r,documentLoader:o,expansionMap:n,addSuiteContext:i=!0}={}){if(n)throw new Error('"expansionMap" not supported.');if("object"!=typeof e)throw new TypeError('The "document" parameter must be an object.');t.ensureSuiteContext({document:e,addSuiteContext:i});try{return await(new ce).add(e,{suite:t,purpose:r,documentLoader:o})}catch(e){if(!o&&"jsonld.InvalidUrl"===e.name){const{details:{url:t}}=e,r=new Error(`A URL "${t}" could not be fetched; you need to pass "documentLoader" or resolve the URL before calling "sign".`);throw r.cause=e,r}throw e}},ie.verify=async function(e,{suite:t,purpose:r,documentLoader:o,expansionMap:n}={}){if(n)throw new Error('"expansionMap" not supported.');if("object"!=typeof e)throw new TypeError('The "document" parameter must be an object.');const i=await(new ce).verify(e,{suite:t,purpose:r,documentLoader:o}),{error:a}=i;if(a)if(o||"jsonld.InvalidUrl"!==a.name)i.error=new pe(a);else{const{details:{url:e}}=a,t=new Error(`A URL "${e}" could not be fetched; you need to pass "documentLoader" or resolve the URL before calling "verify".`);i.error=new pe(t)}return i},ie.suites=B.suites,ie.purposes=ne.purposes,Object.assign(ie,x);var de=e(ae);export{de as j};
