import{l as t,J as e,K as n,h as i}from"./main.js";import{g as r,u as o}from"./pako.esm-7a9981ef-ce496ef7.js";
/*!
 * Copyright (c) 2020 Digital Bazaar, Inc. All rights reserved.
 */function s(t,e){if("number"!=typeof t)throw new TypeError(`"${e}" must be number.`)}function a(t,e){if(!(Number.isInteger(t)&&t>0))throw new TypeError(`"${e}" must be a positive integer.`)}function c(t,e){if("boolean"!=typeof t)throw new TypeError(`"${e}" must be a boolean.`)}function f(t,e){if(!(t instanceof Uint8Array))throw new TypeError(`"${e}" must be a Uint8Array.`)}
/*!
 * Copyright (c) 2018-2022 Digital Bazaar, Inc. All rights reserved.
 */const u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",d=[62,-1,-1,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,64,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,63,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51];
/*!
 * Copyright (c) 2020-2023 Digital Bazaar, Inc. All rights reserved.
 */
class h{constructor({length:t,buffer:e,leftToRightIndexing:n,littleEndianBits:i}={}){if(t&&e)throw new Error('Only one of "length" or "buffer" must be given.');if(void 0!==t?a(t,"length"):f(e,"buffer"),void 0!==i){if(void 0!==n)throw new Error('Using both "littleEndianBits" and "leftToRightIndexing" is not allowed.');c(i,"littleEndianBits"),n=i}void 0===n?n=!0:c(n,"leftToRightIndexing"),t?(this.bits=new Uint8Array(Math.ceil(t/8)),this.length=t):(this.bits=new Uint8Array(e.buffer),this.length=8*e.length),this.leftToRightIndexing=n}set(t,e){s(t,"position"),c(e,"on");const{length:n,leftToRightIndexing:i}=this,{index:r,bit:o}=l(t,n,i);e?this.bits[r]|=o:this.bits[r]&=255^o}get(t){s(t,"position");const{length:e,leftToRightIndexing:n}=this,{index:i,bit:r}=l(t,e,n);return!!(this.bits[i]&r)}async encodeBits(){return function(t){if(!(t instanceof Uint8Array||"string"==typeof t))throw new TypeError('"input" be a string or Uint8Array.');"string"==typeof t&&(t=(new TextEncoder).encode(t));let e,n,i,r="",o=0;for(;o<t.byteLength;)e=t[o++],n=t[o++],i=t[o++],r+=u.charAt(e>>2),r+=u.charAt((3&e)<<4|n>>4),isNaN(n)||(r+=u.charAt((15&n)<<2|i>>6),isNaN(i)||(r+=u.charAt(63&i)));return r}(r(this.bits))}static async decodeBits({encoded:t}){return function(t,e){if("string"!=typeof t)throw new TypeError(`"${e}" must be a string.`)}(t,"encoded"),o(function(t){let e=t.length;const n=e%4;if(1===n)throw new Error("Illegal base64 string.");let i=0;n>0&&(i=4-n,e+=i);const r=new Uint8Array(e/4*3-i);let o,s,a,c,f=0,u=0;for(;f<e;)o=d[t.charCodeAt(f++)-45],s=d[t.charCodeAt(f++)-45],r[u++]=o<<2|s>>4,f<t.length&&(a=d[t.charCodeAt(f++)-45],r[u++]=(15&s)<<4|a>>2,f<t.length&&(c=d[t.charCodeAt(f++)-45],r[u++]=(3&a)<<6|c));return r}(t))}async compressBits(){return r(this.bits)}static async uncompressBits({compressed:t}){return f(t,"compressed"),o(t)}}function l(t,e,n){if(function(t,e){if(!(Number.isInteger(t)&&t>=0))throw new TypeError(`"${e}" must be a non-negative integer.`)}(t,"position"),a(e,"length"),c(n,"leftToRightIndexing"),t>=e)throw new Error(`Position "${t}" is out of range "0-${e-1}".`);const i=t%8;return{index:Math.floor(t/8),bit:1<<(n?7-i:i)}}
/*!
 * Copyright (c) 2020-2022 Digital Bazaar, Inc. All rights reserved.
 */class g{constructor({length:t,buffer:e}={}){this.bitstring=new h({length:t,buffer:e}),this.length=this.bitstring.length}setRevoked(t,e){if("boolean"!=typeof e)throw new TypeError('"revoked" must be a boolean.');return this.bitstring.set(t,e)}isRevoked(t){return this.bitstring.get(t)}async encode(){return this.bitstring.encodeBits()}static async decode({encodedList:t}){const e=await h.decodeBits({encoded:t});return new g({buffer:e})}}
/*!
 * Copyright (c) 2020-2022 Digital Bazaar, Inc. All rights reserved.
 */async function w({encodedList:t}){return g.decode({encodedList:t})}async function b(i){const r=await n({url:i});if(r)try{return JSON.parse(r)}catch(n){throw console.error(n),new t(e.checkRevokedStatus,`No status list could be found at the specified URL for 'statusListCredential': ${i}`)}return r}async function y(t){if("Ed25519Signature2020"===t){const{default:t}=await import("./Ed25519Signature2020-722d8d24-df100275.js");return t}if("EcdsaSecp256k1Signature2019"===t){const{default:t}=await import("./EcdsaSecp256k1Signature2019-01e33e56-6efe219a.js");return t}}async function p(n){const r=await i.verifier.getIssuerProfile(n.issuer);let{proof:o}=n;Array.isArray(o)||(o=[o]);let s=[];for(const i of o){const o={issuer:r,document:n,proof:i,executeStep:async(t,e)=>{try{return await e()}catch(e){console.log("step",t,"failed with error:"),console.error(e),s.push(t)}}},a=new(await y(i.type))(o);await a.verifyProof();const c=s.length>0;if(s=[],c)throw new t(e.checkRevokedStatus,"The authenticity of the revocation list could not be verified.")}}async function m(n){Array.isArray(n)||(n=[n]);for(const i of n){const n=parseInt(i.statusListIndex,10),r=await b(i.statusListCredential);if(!r)throw new t(e.checkRevokedStatus,`No status list could be found at the specified URL for 'statusListCredential': ${i.statusListCredential}.`);await p(r);const{encodedList:o}=r.credentialSubject;if((await w({encodedList:o})).isRevoked(n)){const n="revocation"===i.statusPurpose?"revoked":"suspended";throw new t(e.checkRevokedStatus,`Certificate has been ${n}.`)}}}export{m as default};
