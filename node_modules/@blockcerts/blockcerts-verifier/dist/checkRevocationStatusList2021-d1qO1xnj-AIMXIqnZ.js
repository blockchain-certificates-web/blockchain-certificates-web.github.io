import{l as t,J as e,K as n,C as i,a as s}from"./main.js";import{e as o,d as r}from"./base64url-qi3FT6uz-yv4mTXpu.js";import{g as a,u as c}from"./pako.esm-jjCKMBM4-RAILONW0.js";
/*!
 * Copyright (c) 2020 Digital Bazaar, Inc. All rights reserved.
 */function d(t,e){if("number"!=typeof t)throw new TypeError(`"${e}" must be number.`)}function u(t,e){if(!(Number.isInteger(t)&&t>0))throw new TypeError(`"${e}" must be a positive integer.`)}function f(t,e){if("boolean"!=typeof t)throw new TypeError(`"${e}" must be a boolean.`)}function h(t,e){if(!(t instanceof Uint8Array))throw new TypeError(`"${e}" must be a Uint8Array.`)}
/*!
 * Copyright (c) 2020-2023 Digital Bazaar, Inc. All rights reserved.
 */class l{constructor({length:t,buffer:e,leftToRightIndexing:n,littleEndianBits:i}={}){if(t&&e)throw new Error('Only one of "length" or "buffer" must be given.');if(void 0!==t?u(t,"length"):h(e,"buffer"),void 0!==i){if(void 0!==n)throw new Error('Using both "littleEndianBits" and "leftToRightIndexing" is not allowed.');f(i,"littleEndianBits"),n=i}void 0===n?n=!0:f(n,"leftToRightIndexing"),t?(this.bits=new Uint8Array(Math.ceil(t/8)),this.length=t):(this.bits=new Uint8Array(e.buffer),this.length=8*e.length),this.leftToRightIndexing=n}set(t,e){d(t,"position"),f(e,"on");const{length:n,leftToRightIndexing:i}=this,{index:s,bit:o}=b(t,n,i);e?this.bits[s]|=o:this.bits[s]&=255^o}get(t){d(t,"position");const{length:e,leftToRightIndexing:n}=this,{index:i,bit:s}=b(t,e,n);return!!(this.bits[i]&s)}async encodeBits(){return o(a(this.bits))}static async decodeBits({encoded:t}){return function(t,e){if("string"!=typeof t)throw new TypeError(`"${e}" must be a string.`)}(t,"encoded"),c(r(t))}async compressBits(){return a(this.bits)}static async uncompressBits({compressed:t}){return h(t,"compressed"),c(t)}}function b(t,e,n){if(function(t,e){if(!(Number.isInteger(t)&&t>=0))throw new TypeError(`"${e}" must be a non-negative integer.`)}(t,"position"),u(e,"length"),f(n,"leftToRightIndexing"),t>=e)throw new Error(`Position "${t}" is out of range "0-${e-1}".`);const i=t%8;return{index:Math.floor(t/8),bit:1<<(n?7-i:i)}}
/*!
 * Copyright (c) 2020-2022 Digital Bazaar, Inc. All rights reserved.
 */class g{constructor({length:t,buffer:e}={}){this.bitstring=new l({length:t,buffer:e}),this.length=this.bitstring.length}setRevoked(t,e){if("boolean"!=typeof e)throw new TypeError('"revoked" must be a boolean.');return this.bitstring.set(t,e)}isRevoked(t){return this.bitstring.get(t)}async encode(){return this.bitstring.encodeBits()}static async decode({encodedList:t}){const e=await l.decodeBits({encoded:t});return new g({buffer:e})}}
/*!
 * Copyright (c) 2020-2022 Digital Bazaar, Inc. All rights reserved.
 */async function w({encodedList:t}){return g.decode({encodedList:t})}async function y(i){const s=await n({url:i});if(s)try{return JSON.parse(s)}catch(n){throw console.error(n),new t(e.checkRevokedStatus,`No status list could be found at the specified URL for 'statusListCredential': ${i}`)}return s}async function p(n){const o=new i(n);await o.init();if((await o.verify()).status===s.FAILURE)throw new t(e.checkRevokedStatus,"The authenticity of the revocation list could not be verified.")}async function m(n){Array.isArray(n)||(n=[n]);for(const i of n){const n=parseInt(i.statusListIndex,10),s=await y(i.statusListCredential);if(!s)throw new t(e.checkRevokedStatus,`No status list could be found at the specified URL for 'statusListCredential': ${i.statusListCredential}.`);await p(s);const{encodedList:o}=s.credentialSubject;if((await w({encodedList:o})).isRevoked(n)){const n="revocation"===i.statusPurpose?"revoked":"suspended";throw new t(e.checkRevokedStatus,`Certificate has been ${n}.`)}}}export{m as default};
