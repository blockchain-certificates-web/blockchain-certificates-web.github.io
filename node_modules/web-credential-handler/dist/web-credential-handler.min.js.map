{"version":3,"sources":["webpack://WebCredentialHandler/webpack/universalModuleDefinition","webpack://WebCredentialHandler/webpack/bootstrap","webpack://WebCredentialHandler/./node_modules/web-request-rpc/utils.js","webpack://WebCredentialHandler/./node_modules/web-request-rpc/Client.js","webpack://WebCredentialHandler/./node_modules/web-request-rpc/Server.js","webpack://WebCredentialHandler/./node_modules/web-request-rpc/WebAppWindowDialog.js","webpack://WebCredentialHandler/./node_modules/web-request-rpc/WebAppWindowInlineDialog.js","webpack://WebCredentialHandler/./node_modules/web-request-rpc/WebAppWindowPopupDialog.js","webpack://WebCredentialHandler/./node_modules/web-request-rpc/WebAppWindow.js","webpack://WebCredentialHandler/./node_modules/web-request-rpc/WebAppContext.js","webpack://WebCredentialHandler/./CredentialEventProxy.js","webpack://WebCredentialHandler/./node_modules/web-request-rpc/WebApp.js","webpack://WebCredentialHandler/./index.js"],"names":["root","factory","exports","module","define","amd","window","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","RPC_ERRORS","message","code","parseUrl","url","base","undefined","location","href","URL","TypeError","includes","startsWith","parser","document","createElement","origin","protocol","host","port","hostname","pathname","uuidv4","a","b","Math","random","toString","isValidMessage","jsonrpc","id","createMessageListener","listener","handle","expectRequest","isHandlePromise","promise","then","h","e","source","data","Array","isArray","params","error","isValidResponse","this","_handle","_listener","_pending","Map","options","Error","opener","parent","pending","has","resolve","reject","cancelTimeout","result","err","constructor","DOMException","details","addEventListener","Injector","qualifiedMethodName","parameters","timeout","self","method","postMessage","Promise","timeoutId","setTimeout","delete","clearTimeout","set","removeEventListener","values","client","_apis","definition","functions","api","forEach","fn","async","send","arguments","ignoreUnknownApi","fqMethodName","rest","split","pop","join","sendMethodNotFound","response","apply","assign","WebAppWindowDialog","_closeEventListeners","Set","add","clear","className","super","dialog","applyStyle","position","top","left","width","height","display","margin","padding","border","background","color","overflow","style","appendChild","createTextNode","container","iframe","src","scrolling","preventDefault","hide","body","contentWindow","showModal","close","console","parentNode","removeChild","destroy","element","bounds","_locationChanging","_openWindow","destroyed","_removeListeners","closed","x","y","min","innerWidth","innerHeight","features","screenX","screenY","open","_addListeners","replace","destroyDialog","loadDialog","unloadDialog","once","intervalId","setInterval","isClosed","clearInterval","removeListener","popup","customize","visible","windowControl","_destroyed","_ready","_private","_timeoutId","_dialog","_readyPromise","_resolveReady","_rejectReady","isReady","moveTo","resizeTo","webAppWindow","querySelector","_bodyOverflowStyle","show","server","injector","control","loaded","listen","connect","relyingOrigin","_control","_connected","ready","resolveReceive","rejectReceive","event","resolveSend","rejectSend","respondWith","installHandler","CredentialManager","navigator","credentialsPolyfill","requestPermission","activateHandler","mediatorOrigin","store","CredentialHandler","receiveCredentialEvent","receive","type","dataType","appContext","openWindow","windowReady","createWindow","credentialRequestOptions","credentialRequestOrigin","credential","hintKey","createResponse"],"mappings":"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","file":"web-credential-handler.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"WebCredentialHandler\"] = factory();\n\telse\n\t\troot[\"WebCredentialHandler\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","/*!\n * Utilities for Web Request RPC.\n *\n * Copyright (c) 2017 Digital Bazaar, Inc. All rights reserved.\n */\n/* global URL */\n'use strict';\n\nexport const RPC_ERRORS = {\n  ParseError: {\n    message: 'Parse error',\n    code: -32700\n  },\n  InvalidRequest: {\n    message: 'Invalid Request',\n    code: -32600\n  },\n  MethodNotFound: {\n    message: 'Method not found',\n    code: -32601\n  },\n  InvalidParams: {\n    message: 'Invalid params',\n    code: -32602\n  },\n  InternalError: {\n    message: 'Internal Error',\n    code: -32603\n  },\n  ServerError: {\n    message: 'Server error',\n    code: -32000\n  }\n};\n\nexport function parseUrl(url, base) {\n  if(base === undefined) {\n    base = window.location.href;\n  }\n\n  if(typeof URL === 'function') {\n    return new URL(url, base);\n  }\n\n  if(typeof url !== 'string') {\n    throw new TypeError('\"url\" must be a string.');\n  }\n\n  // FIXME: rudimentary relative URL resolution\n  if(!url.includes(':')) {\n    if(base.startsWith('http') && !url.startsWith('/')) {\n      url = base + '/' + url;\n    } else {\n      url = base + url;\n    }\n  }\n\n  // `URL` API not supported, use DOM to parse URL\n  const parser = document.createElement('a');\n  parser.href = url;\n  let origin = (parser.protocol || window.location.protocol) + '//';\n  if(parser.host) {\n    // use hostname when using default ports\n    // (IE adds always adds port to `parser.host`)\n    if((parser.protocol === 'http:' && parser.port === '80') ||\n      (parser.protocol === 'https:' && parser.port === '443')) {\n      origin += parser.hostname;\n    } else {\n      origin += parser.host;\n    }\n  } else {\n    origin += window.location.host;\n  }\n\n  // ensure pathname begins with `/`\n  let pathname = parser.pathname;\n  if(!pathname.startsWith('/')) {\n    pathname = '/' + pathname;\n  }\n\n  return {\n    // TODO: is this safe for general use on every browser that doesn't\n    //   support WHATWG URL?\n    host: parser.host || window.location.host,\n    hostname: parser.hostname,\n    origin: origin,\n    protocol: parser.protocol,\n    pathname: pathname\n  };\n}\n\nexport function originMatches(url, origin) {\n  return parseUrl(url, origin).origin === origin;\n}\n\n// https://gist.github.com/LeverOne/1308368\nexport function uuidv4(a,b) {\n  for(b=a='';a++<36;b+=a*51&52?(a^15?8^Math.random()*(a^20?16:4):4).toString(16):'-');return b;\n}\n\nexport function isValidOrigin(url, origin) {\n  if(!originMatches(url, origin)) {\n    throw new Error(\n      `Origin mismatch. Url \"${url}\" does not have an origin of \"${origin}\".`);\n  }\n}\n\nexport function isValidMessage(message) {\n  return (\n    message && typeof message === 'object' &&\n    message.jsonrpc === '2.0' &&\n    message.id && typeof message.id === 'string');\n}\n\nexport function isValidRequest(message) {\n  return isValidMessage(message) && Array.isArray(message.params);\n}\n\nexport function isValidResponse(message) {\n  return (\n    isValidMessage(message) &&\n    !!('result' in message ^ 'error' in message) &&\n    (!('error' in message) || isValidError(message.error)));\n}\n\nexport function isValidError(error) {\n  return (\n    error && typeof error === 'object' &&\n    typeof error.code === 'number' &&\n    typeof error.message === 'string');\n}\n\nexport function serializeError(error) {\n  const err = {\n    message: error.message\n  };\n  if(error.constructor.name !== 'Error') {\n    err.constructor = error.constructor.name;\n  }\n  if('name' in error) {\n    err.name = error.name;\n  }\n  if('code' in error) {\n    err.code = error.code;\n  } else {\n    err.code = RPC_ERRORS.ServerError.code;\n  }\n  if('details' in error) {\n    err.details = error.details;\n  }\n  return err;\n}\n\nexport function deserializeError(error) {\n  let err;\n  // special case known types, otherwise use generic Error\n  if(error.constructor === 'DOMException') {\n    err = new DOMException(error.message, error.name)\n    // ignore code, name will set it\n  } else {\n    err = new Error(error.message);\n    if('code' in error) {\n      err.code = error.code;\n    }\n  }\n  if(error.details) {\n    err.details = error.details;\n  }\n  return err;\n}\n\nexport function createMessageListener(\n  {listener, origin, handle, expectRequest}) {\n  // HACK: we can't just `Promise.resolve(handle)` because Chrome has\n  // a bug that throws an exception if the handle is cross domain\n  if(isHandlePromise(handle)) {\n    const promise = handle;\n    handle = false;\n    promise.then(h => handle = h);\n  }\n  return e => {\n    // ignore messages from a non-matching handle or origin\n    // or that don't follow the protocol\n    if(!(e.source === handle && e.origin === origin &&\n      ((expectRequest && isValidRequest(e.data)) ||\n        (!expectRequest && isValidResponse(e.data))))) {\n      return;\n    }\n    listener(e.data, e);\n  };\n}\n\nexport function destructureMethodName(fqMethodName) {\n  // fully-qualified method name is: `<api-name>.<method-name>`\n  // where `<api-name>` is all but the last dot-delimited segment and\n  // `<method-name>` is the last dot-delimited segment\n  let [name, ...rest] = fqMethodName.split('.');\n  const method = rest.pop();\n  name = [name, ...rest].join('.');\n  return {name, method};\n}\n\nexport function isHandlePromise(handle) {\n  try {\n    // HACK: we can't just `Promise.resolve(handle)` because Chrome has\n    // a bug that throws an exception if the handle is cross domain\n    return typeof handle.then === 'function';\n  } catch(e) {}\n  return false;\n}\n","/*!\n * Copyright (c) 2017 Digital Bazaar, Inc. All rights reserved.\n */\n'use strict';\n\nimport * as utils from './utils.js';\n\n// 30 second default timeout\nconst RPC_CLIENT_CALL_TIMEOUT = 30000;\n\nexport class Client {\n  constructor() {\n    this.origin = null;\n    this._handle = null;\n    this._listener = null;\n    // all pending requests\n    this._pending = new Map();\n  }\n\n  /**\n   * Connects to a Web Request RPC server.\n   *\n   * The Promise will resolve to an RPC injector that can be used to get or\n   * define APIs to enable communication with the server.\n   *\n   * @param origin the origin to send messages to.\n   * @param options the options to use:\n   *          [handle] a handle to the window (or a Promise that resolves to\n   *            a handle) to send messages to\n   *            (defaults to `window.opener || window.parent`).\n   *\n   * @return a Promise that resolves to an RPC injector once connected.\n   */\n  async connect(origin, options) {\n    if(this._listener) {\n      throw new Error('Already connected.');\n    }\n\n    options = options || {};\n\n    // TODO: validate `origin` and `options.handle`\n    const self = this;\n    self.origin = utils.parseUrl(origin).origin;\n    self._handle = options.handle || window.opener || window.parent;\n\n    const pending = self._pending;\n    self._listener = utils.createMessageListener({\n      origin: self.origin,\n      handle: self._handle,\n      expectRequest: false,\n      listener: message => {\n        // ignore messages that have no matching, pending request\n        if(!pending.has(message.id)) {\n          return;\n        }\n\n        // resolve or reject Promise associated with message\n        const {resolve, reject, cancelTimeout} = pending.get(message.id);\n        cancelTimeout();\n        if('result' in message) {\n          return resolve(message.result);\n        }\n        reject(utils.deserializeError(message.error));\n      }\n    });\n    window.addEventListener('message', self._listener);\n\n    return new Injector(self);\n  }\n\n  /**\n   * Performs a RPC by sending a message to the Web Request RPC server and\n   * awaiting a response.\n   *\n   * @param qualifiedMethodName the fully-qualified name of the method to call.\n   * @param parameters the parameters for the method.\n   * @param options the options to use:\n   *          [timeout] a timeout, in milliseconds, for awaiting a response;\n   *            a non-positive timeout (<= 0) will cause an indefinite wait.\n   *\n   * @return a Promise that resolves to the result (or error) of the call.\n   */\n  async send(qualifiedMethodName, parameters, {\n    timeout = RPC_CLIENT_CALL_TIMEOUT\n  }) {\n    if(!this._listener) {\n      throw new Error('RPC client not connected.');\n    }\n\n    const self = this;\n\n    const message = {\n      jsonrpc: '2.0',\n      id: utils.uuidv4(),\n      method: qualifiedMethodName,\n      params: parameters\n    };\n\n    // HACK: we can't just `Promise.resolve(handle)` because Chrome has\n    // a bug that throws an exception if the handle is cross domain\n    if(utils.isHandlePromise(self._handle)) {\n      const handle = await self._handle;\n      handle.postMessage(message, self.origin);\n    } else {\n      self._handle.postMessage(message, self.origin);\n    }\n\n    // return Promise that will resolve once a response message has been\n    // received or once a timeout occurs\n    return new Promise((resolve, reject) => {\n      const pending = self._pending;\n      let cancelTimeout;\n      if(timeout > 0) {\n        const timeoutId = setTimeout(() => {\n          pending.delete(message.id);\n          reject(new Error('RPC call timed out.'));\n        }, timeout);\n        cancelTimeout = () => {\n          pending.delete(message.id);\n          clearTimeout(timeoutId);\n        };\n      } else {\n        cancelTimeout = () => {\n          pending.delete(message.id);\n        };\n      }\n      pending.set(message.id, {resolve, reject, cancelTimeout});\n    });\n  }\n\n  /**\n   * Disconnects from the remote Web Request RPC server and closes down this\n   * client.\n   */\n  close() {\n    if(this._listener) {\n      window.removeEventListener('message', this._listener);\n      this._handle = this.origin = this._listener = null;\n      // reject all pending calls\n      for(const value of this._pending.values()) {\n        value.reject(new Error('RPC client closed.'));\n      }\n      this._pending = new Map();\n    }\n  }\n}\n\nclass Injector {\n  constructor(client) {\n    this.client = client;\n    this._apis = new Map();\n  }\n\n  /**\n   * Defines a named API that will use an RPC client to implement its\n   * functions. Each of these functions will be asynchronous and return a\n   * Promise with the result from the RPC server.\n   *\n   * This function will return an interface with functions defined according\n   * to those provided in the given `definition`. The `name` parameter can be\n   * used to obtain this cached interface via `.get(name)`.\n   *\n   * @param name the name of the API.\n   * @param definition the definition for the API, including:\n   *          functions: an array of function names (as strings) or objects\n   *            containing: {name: <functionName>, options: <rpcClientOptions>}.\n   *\n   * @return an interface with the functions provided via `definition` that\n   *           will make RPC calls to an RPC server to provide their\n   *           implementation.\n   */\n  define(name, definition) {\n    if(!(name && typeof name === 'string')) {\n      throw new TypeError('`name` must be a non-empty string.');\n    }\n    // TODO: support Web IDL as a definition format?\n    if(!(definition && typeof definition === 'object' &&\n      Array.isArray(definition.functions))) {\n      throw new TypeError(\n        '`definition.function` must be an array of function names or ' +\n        'function definition objects to be defined.');\n    }\n\n    const self = this;\n    const api = {};\n\n    definition.functions.forEach(fn => {\n      if(typeof fn === 'string') {\n        fn = {name: fn, options: {}};\n      }\n      api[fn.name] = async function() {\n        return self.client.send(\n          name + '.' + fn.name, [...arguments], fn.options);\n      };\n    });\n\n    self._apis[name] = api;\n    return api;\n  }\n\n  /**\n   * Get a named API, defining it if necessary when a definition is provided.\n   *\n   * @param name the name of the API.\n   * @param [definition] the definition for the API; if the API is already\n   *          defined, this definition is ignored.\n   *\n   * @return the interface.\n   */\n  get(name, definition) {\n    const api = this._apis[name];\n    if(!api) {\n      if(definition) {\n        return this.define(name, definition);\n      }\n      throw new Error(`API \"${name}\" has not been defined.`);\n    }\n    return this._apis[name];\n  }\n}\n","/*!\n * Copyright (c) 2017 Digital Bazaar, Inc. All rights reserved.\n */\n'use strict';\n\nimport * as utils from './utils.js';\n\nexport class Server {\n  constructor() {\n    this.origin = null;\n    this._handle = null;\n    this._apis = new Map();\n  }\n\n  /**\n   * Provides an implementation for a named API. All functions in the given\n   * API will be made callable via RPC clients connected to this server.\n   *\n   * @param name the name of the API.\n   * @param api the API to add.\n   */\n  define(name, api) {\n    if(!(name && typeof name === 'string')) {\n      throw new TypeError('`name` must be a non-empty string.');\n    }\n    if(!(api && api !== 'object')) {\n      throw new TypeError('`api` must be an object.');\n    }\n    if(name in this._apis) {\n      throw new Error(`The \"${name}\" API is already defined.`);\n    }\n\n    this._apis[name] = api;\n  }\n\n  /**\n   * Listens for RPC messages from clients from a particular origin and\n   * window handle and uses them to execute API calls based on predefined\n   * APIs.\n   *\n   * If messages are not from the given origin or window handle, they are\n   * ignored. If the messages refer to named APIs that have not been defined\n   * then an error message is sent in response. These error messages can\n   * be suppressed by using the `ignoreUnknownApi` option.\n   *\n   * If a message refers to an unknown method on a known named API, then an\n   * error message is sent in response.\n   *\n   * @param origin the origin to listen for.\n   * @param options the options to use:\n   *          [handle] a handle to the window (or a Promise that resolves to\n   *            a handle) to listen for messages from\n   *            (defaults to `window.opener || window.parent`).\n   *          [ignoreUnknownApi] `true` to ignore unknown API messages.\n   */\n  async listen(origin, options) {\n    if(this._listener) {\n      throw new Error('Already listening.');\n    }\n\n    options = options || {};\n\n    // TODO: validate `origin` and `options.handle`\n    const self = this;\n    self.origin = utils.parseUrl(origin).origin;\n    self._handle = options.handle || window.opener || window.parent;\n\n    const ignoreUnknownApi = (options.ignoreUnknownApi === 'true') || false;\n\n    self._listener = utils.createMessageListener({\n      origin: self.origin,\n      handle: self._handle,\n      expectRequest: true,\n      listener: message => {\n        const {name, method} = utils.destructureMethodName(message.method);\n        const api = self._apis[name];\n\n        // do not allow calling \"private\" methods (starts with `_`)\n        if(method && method.startsWith('_')) {\n          return sendMethodNotFound(self._handle, self.origin, message);\n        }\n\n        // API not found but ignore flag is on\n        if(!api && ignoreUnknownApi) {\n          // API not registered, ignore the message rather than raise error\n          return;\n        }\n\n        // no ignore flag and unknown API or unknown specific method\n        if(!api || typeof api[method] !== 'function') {\n          return sendMethodNotFound(self._handle, self.origin, message);\n        }\n\n        // API and specific function found\n        const fn = api[method];\n        (async () => {\n          const response = {\n            jsonrpc: '2.0',\n            id: message.id\n          };\n          try {\n            response.result = await fn.apply(api, message.params);\n          } catch(e) {\n            response.error = utils.serializeError(e);\n          }\n          // if server did not `close` while we waited for a response\n          if(self._handle) {\n            // HACK: we can't just `Promise.resolve(handle)` because Chrome has\n            // a bug that throws an exception if the handle is cross domain\n            if(utils.isHandlePromise(self._handle)) {\n              self._handle.then(h => h.postMessage(response, self.origin));\n            } else {\n              self._handle.postMessage(response, self.origin);\n            }\n          }\n        })();\n      }\n    });\n    window.addEventListener('message', self._listener);\n  }\n\n  close() {\n    if(this._listener) {\n      window.removeEventListener('message', this._listener);\n      this._handle = this.origin = this._listener = null;\n    }\n  }\n}\n\nfunction sendMethodNotFound(handle, origin, message) {\n  const response = {\n    jsonrpc: '2.0',\n    id: message.id,\n    error: Object.assign({}, utils.RPC_ERRORS.MethodNotFound)\n  };\n  // HACK: we can't just `Promise.resolve(handle)` because Chrome has\n  // a bug that throws an exception if the handle is cross domain\n  if(utils.isHandlePromise(handle)) {\n    return handle.then(h => h.postMessage(response, origin));\n  } else {\n    return handle.postMessage(response, origin);\n  }\n}\n","/*!\n * Copyright (c) 2022 Digital Bazaar, Inc. All rights reserved.\n */\nexport class WebAppWindowDialog {\n  constructor() {\n    this._closeEventListeners = new Set();\n  }\n\n  addEventListener(name, listener) {\n    if(name !== 'close') {\n      throw new Error(`Unknown event \"${name}\".`);\n    }\n    if(typeof listener !== 'function') {\n      throw new TypeError('\"listener\" must be a function.');\n    }\n    this._closeEventListeners.add(listener);\n  }\n\n  removeEventListener(name, listener) {\n    if(name !== 'close') {\n      throw new Error(`Unknown event \"${name}\".`);\n    }\n    if(typeof listener !== 'function') {\n      throw new TypeError('\"listener\" must be a function.');\n    }\n    this._closeEventListeners.delete(listener);\n  }\n\n  show() {}\n\n  close() {\n    // emit event to all `close` event listeners\n    for(const listener of this._closeEventListeners) {\n      listener({});\n    }\n  }\n\n  destroy() {\n    this._closeEventListeners.clear();\n  }\n}\n","/*!\n * Copyright (c) 2022 Digital Bazaar, Inc. All rights reserved.\n */\nimport {WebAppWindowDialog} from './WebAppWindowDialog.js';\n\nexport class WebAppWindowInlineDialog extends WebAppWindowDialog {\n  constructor({url, handle, className}) {\n    super();\n    this.url = url;\n    this.handle = handle;\n    // create a top-level dialog overlay\n    this.dialog = document.createElement('dialog');\n    applyStyle(this.dialog, {\n      position: 'fixed',\n      top: 0,\n      left: 0,\n      width: '100%',\n      height: '100%',\n      'max-width': '100%',\n      'max-height': '100%',\n      display: 'none',\n      margin: 0,\n      padding: 0,\n      border: 'none',\n      background: 'transparent',\n      color: 'black',\n      'box-sizing': 'border-box',\n      overflow: 'hidden',\n      'z-index': 1000000\n    });\n    this.dialog.className = 'web-app-window';\n    if(typeof className === 'string') {\n      this.dialog.className = this.dialog.className + ' ' + className;\n    }\n\n    // ensure backdrop is transparent by default\n    const style = document.createElement('style');\n    style.appendChild(\n      document.createTextNode(`dialog.web-app-window::backdrop {\n        background-color: transparent;\n      }`));\n\n    // create flex container for iframe\n    this.container = document.createElement('div');\n    applyStyle(this.container, {\n      position: 'relative',\n      width: '100%',\n      height: '100%',\n      margin: 0,\n      padding: 0,\n      display: 'flex',\n      'flex-direction': 'column'\n    });\n    this.container.className = 'web-app-window-backdrop';\n\n    // create iframe\n    this.iframe = document.createElement('iframe');\n    this.iframe.src = url;\n    this.iframe.scrolling = 'auto';\n    applyStyle(this.iframe, {\n      position: 'fixed',\n      top: 0,\n      left: 0,\n      width: '100%',\n      height: '100%',\n      border: 'none',\n      background: 'transparent',\n      overflow: 'hidden',\n      margin: 0,\n      padding: 0,\n      'flex-grow': 1\n    });\n\n    // assemble dialog\n    this.dialog.appendChild(style);\n    this.container.appendChild(this.iframe);\n    this.dialog.appendChild(this.container);\n\n    // a.document.appendChild(this.iframe);\n    // handle cancel (user pressed escape)\n    this.dialog.addEventListener('cancel', e => {\n      e.preventDefault();\n      this.hide();\n    });\n\n    // attach to DOM\n    document.body.appendChild(this.dialog);\n    this.handle = this.iframe.contentWindow;\n  }\n\n  show() {\n    this.dialog.style.display = 'block';\n    if(this.dialog.showModal) {\n      this.dialog.showModal();\n    }\n  }\n\n  close() {\n    this.dialog.style.display = 'none';\n    if(this.dialog.close) {\n      try {\n        this.dialog.close();\n      } catch(e) {\n        console.error(e);\n      }\n    }\n    super.close();\n  }\n\n  destroy() {\n    this.dialog.parentNode.removeChild(this.dialog);\n    super.destroy();\n  }\n}\n\nfunction applyStyle(element, style) {\n  for(const name in style) {\n    element.style[name] = style[name];\n  }\n}\n","/*!\n * Copyright (c) 2022 Digital Bazaar, Inc. All rights reserved.\n */\nimport {WebAppWindowDialog} from './WebAppWindowDialog.js';\n\nexport class WebAppWindowPopupDialog extends WebAppWindowDialog {\n  constructor({url, handle, bounds = {width: 500, height: 400}}) {\n    super();\n    this.url = url;\n    this.handle = handle;\n    this._locationChanging = false;\n    if(!handle) {\n      this._openWindow({url, name: 'web-app-window', bounds});\n    }\n    this.destroyed = false;\n    this._removeListeners = () => {};\n  }\n\n  show() {}\n\n  close() {\n    this.destroy();\n  }\n\n  destroy() {\n    if(this.handle && !this.destroyed) {\n      this.handle.close();\n      super.close();\n      this.handle = null;\n      this.destroyed = true;\n      this._removeListeners();\n      super.destroy();\n    }\n  }\n\n  isClosed() {\n    return !this.handle || this.handle.closed;\n  }\n\n  _openWindow({url, name, bounds}) {\n    const {x, y} = bounds;\n    let {width = 500, height = 400} = bounds;\n    width = Math.min(width, window.innerWidth);\n    height = Math.min(height, window.innerHeight);\n    const left = x !== undefined ?\n      x : window.screenX + (window.innerWidth - width) / 2;\n    const top = y !== undefined ?\n      y : window.screenY + (window.innerHeight - height) / 2;\n    const features =\n      'popup=yes,menubar=no,location=no,resizable=no,scrollbars=no,status=no,' +\n      `width=${width},height=${height},left=${left},top=${top}`;\n    this._locationChanging = true;\n    this.handle = window.open(url, name, features);\n\n    this._addListeners();\n  }\n\n  setLocation(url) {\n    this.url = url;\n    this._locationChanging = true;\n    this.handle.location.replace(url);\n  }\n\n  _addListeners() {\n    const destroyDialog = () => this.destroy();\n\n    // when a new URL loads in the dialog, clear the location changing flag\n    const loadDialog = () => {\n      this._locationChanging = false;\n    };\n\n    // when the dialog URL changes...\n    const unloadDialog = () => {\n      if(this._locationChanging) {\n        // a location change was expected, return\n        return;\n      }\n\n      // a location change was NOT expected, destroy the dialog\n      this.destroy();\n    };\n\n    this.handle.addEventListener('unload', unloadDialog);\n    this.handle.addEventListener('load', loadDialog);\n\n    // before the current window unloads, destroy the child dialog\n    window.addEventListener('beforeUnload', destroyDialog, {once: true});\n\n    // poll to check for closed window handle; necessary because cross domain\n    // windows will not emit any close-related events we can use here\n    const intervalId = setInterval(() => {\n      if(this.isClosed()) {\n        this.destroy();\n        clearInterval(intervalId);\n      }\n    }, 250);\n\n    // create listener clean up function\n    this._removeListeners = () => {\n      clearInterval(intervalId);\n      this.handle.removeListener('unload', unloadDialog);\n      this.handle.removeListener('load', loadDialog);\n      window.removeEventListener('beforeUnload', destroyDialog);\n    }\n  }\n}\n","/*!\n * Copyright (c) 2017-2022 Digital Bazaar, Inc. All rights reserved.\n */\nimport {WebAppWindowInlineDialog} from './WebAppWindowInlineDialog.js';\nimport {WebAppWindowPopupDialog} from './WebAppWindowPopupDialog.js';\n\n// default timeout is 60 seconds\nconst LOAD_WINDOW_TIMEOUT = 60000;\n\n/**\n * Provides a window and API for remote Web applications. This API is typically\n * used by RPC WebApps that run in a WebAppContext to indicate when they are\n * ready and to show/hide their UI.\n */\nexport class WebAppWindow {\n  constructor(\n    url, {\n      timeout = LOAD_WINDOW_TIMEOUT,\n      dialog = null,\n      handle,\n      popup = false,\n      className = null,\n      customize = null,\n      // top, left, width, height\n      bounds\n    } = {}) {\n    this.visible = false;\n    this.dialog = dialog;\n    this.handle = null;\n    this.popup = popup;\n    this.windowControl = null;\n    this._destroyed = false;\n    this._ready = false;\n    this._private = {};\n    this._timeoutId = null;\n\n    if(handle && handle._dialog) {\n      this.dialog = dialog = handle._dialog;\n    }\n    // private to allow caller to track readiness\n    this._private._readyPromise = new Promise((resolve, reject) => {\n      // reject if timeout reached\n      this._timeoutId = setTimeout(\n        () => reject(new DOMException(\n          'Loading Web application window timed out.', 'TimeoutError')),\n        timeout);\n      this._private._resolveReady = value => {\n        clearTimeout(this.timeoutId);\n        this._timeoutId = null;\n        resolve(value);\n      };\n      this._private._rejectReady = err => {\n        clearTimeout(this.timeoutId);\n        this._timeoutId = null;\n        reject(err);\n      };\n    });\n    this._private.isReady = async () => {\n      return this._private._readyPromise;\n    };\n\n    // private to disallow destruction via client\n    this._private.destroy = () => {\n      // window not ready yet, but destroyed\n      if(this._timeoutId) {\n        this._private._rejectReady(new DOMException(\n          'Web application window closed before ready.', 'AbortError'));\n      }\n      if(!this._destroyed) {\n        this.dialog.destroy();\n        this.dialog = null;\n        this._destroyed = true;\n      }\n    };\n\n    if(customize) {\n      if(!typeof customize === 'function') {\n        throw new TypeError('`options.customize` must be a function.');\n      }\n    }\n\n    if(!this.dialog) {\n      if(this.popup) {\n        this.dialog = new WebAppWindowPopupDialog({url, handle, bounds});\n      } else {\n        this.dialog = new WebAppWindowInlineDialog({url, handle, className});\n      }\n    } else if(this.popup && bounds) {\n      // resize / re-position popup window as requested\n      if(bounds) {\n        const {top: y, left: x, width, height} = bounds;\n        if(x !== undefined && y !== undefined) {\n          this.dialog.handle.moveTo(x, y);\n        }\n        if(width !== undefined && height !== undefined) {\n          this.dialog.handle.resizeTo(width, height);\n        }\n      }\n    }\n\n    this.handle = this.dialog.handle;\n    if(customize) {\n      try {\n        customize({\n          dialog: this.dialog.dialog,\n          container: this.dialog.container,\n          iframe: this.dialog.iframe,\n          webAppWindow: this\n        });\n      } catch(e) {\n        console.error(e);\n      }\n    }\n  }\n\n  /**\n   * Called by the client when it is ready to receive messages.\n   */\n  ready() {\n    this._ready = true;\n    this._private._resolveReady(true);\n  }\n\n  /**\n   * Called by the client when it wants to show UI.\n   */\n  show() {\n    if(!this.visible) {\n      this.visible = true;\n      // disable scrolling on body\n      const body = document.querySelector('body');\n      this._bodyOverflowStyle = body.style.overflow;\n      body.style.overflow = 'hidden';\n      if(!this._destroyed) {\n        this.dialog.show();\n      } else if(this.windowControl.show) {\n        this.windowControl.show();\n      }\n    }\n  }\n\n  /**\n   * Called by the client when it wants to hide UI.\n   */\n  hide() {\n    if(this.visible) {\n      this.visible = false;\n      // restore `overflow` style on body\n      const body = document.querySelector('body');\n      if(this._bodyOverflowStyle) {\n        body.style.overflow = this._bodyOverflowStyle;\n      } else {\n        body.style.overflow = '';\n      }\n      if(!this._destroyed) {\n        this.dialog.close();\n      } else if(this.windowControl.hide) {\n        this.windowControl.hide();\n      }\n    }\n  }\n}\n","/*!\n * Copyright (c) 2017-2022 Digital Bazaar, Inc. All rights reserved.\n */\nimport {Client} from './Client.js';\nimport {Server} from './Server.js';\nimport {WebAppWindow} from './WebAppWindow.js';\nimport {parseUrl} from './utils.js';\n\n// 10 seconds\nconst WEB_APP_CONTEXT_LOAD_TIMEOUT = 10000;\n\nexport class WebAppContext {\n  constructor() {\n    this.client = new Client();\n    this.server = new Server();\n    this.injector = null;\n    this.control = null;\n    this.loaded = false;\n    this.closed = false;\n  }\n\n  /**\n   * Creates a window (or attaches to an existing one) that loads a page that\n   * is expected to understand the web request RPC protocol. This method\n   * returns a Promise that will resolve once the page uses RPC to indicate\n   * that it is ready to be communicated with or once a timeout occurs.\n   *\n   * The Promise will resolve to an RPC injector that can be used to get or\n   * define APIs to enable communication with the WebApp running in the\n   * WebAppContext.\n   *\n   * @param url the URL to the page to connect to.\n   * @param options the options to use:\n   *          [timeout] the timeout for waiting for the client to be ready.\n   *          [handle] a window handle to connect to; may be a Promise that\n   *            that resolves to a handle.\n   *          [iframe] an iframe element to connect to.\n   *          [windowControl] a window control interface to connect to.\n   *          [className] a className to assign to the window for CSS purposes.\n   *          [customize(options)] a function to customize the dialog that\n   *            loads the window after its construction.\n   *          [bounds] a bounding rectangle (top, left, width, height) to\n   *            use when creating a popup window.\n   *\n   * @return a Promise that resolves to an RPC injector once the window is\n   *           ready.\n   */\n  async createWindow(\n    url, {\n      timeout = WEB_APP_CONTEXT_LOAD_TIMEOUT,\n      iframe,\n      dialog = null,\n      popup = false,\n      handle,\n      windowControl,\n      className,\n      customize,\n      // top, left, width, height\n      bounds\n    } = {}) {\n    // disallow loading the same WebAppContext more than once\n    if(this.loaded) {\n      throw new Error('AppContext already loaded.');\n    }\n    this.loaded = true;\n\n    // create control API for WebApp to call via its own RPC client\n    this.control = new WebAppWindow(url, {\n      timeout,\n      dialog,\n      iframe,\n      popup,\n      handle,\n      windowControl,\n      className,\n      customize,\n      bounds\n    });\n\n    // if the local window closes, close the control window as well\n    window.addEventListener('pagehide', () => this.close(), {once: true});\n\n    // define control class; this enables the WebApp that is running in the\n    // WebAppContext to control its UI or close itself down\n    this.server.define('core.control', this.control);\n\n    // listen for calls from the window, ignoring calls to unknown APIs\n    // to allow those to be handled by other servers\n    const origin = parseUrl(url).origin;\n    this.server.listen(origin, {\n      handle: this.control.handle,\n      ignoreUnknownApi: true\n    });\n\n    // wait for control to be ready\n    await this.control._private.isReady();\n\n    // connect to the WebAppContext and return the injector\n    this.injector = await this.client.connect(origin, {\n      handle: this.control.handle\n    });\n    return this.injector;\n  }\n\n  close() {\n    if(!this.closed) {\n      this.closed = true;\n      this.control._private.destroy();\n      this.server.close();\n      this.client.close();\n    }\n  }\n}\n","/*!\n * Copyright (c) 2017-2018 Digital Bazaar, Inc. All rights reserved.\n */\n/* global window */\n'use strict';\n\nimport {WebApp} from 'web-request-rpc';\n\nconst PROXY_EVENT_TIMEOUT = 60000;\n\nexport class CredentialEventProxy extends WebApp {\n  constructor() {\n    super(window.location.origin);\n  }\n\n  async receive() {\n    const self = this;\n    await self.connect();\n\n    // this promise resolves once the event is received\n    return new Promise((resolveReceive, rejectReceive) => {\n      const timeoutId = setTimeout(() => {\n        rejectReceive(new Error('Timed out waiting to receive event.'));\n      }, PROXY_EVENT_TIMEOUT);\n\n      self.server.define('credentialEventProxy', {\n        // called by credential handler to send event to UI window\n        async send(event) {\n          // event received, clear timeout\n          resolveReceive(event);\n          clearTimeout(timeoutId);\n\n          // this promise resolves when the promise that the UI passes\n          // to `event.respondWith` resolves\n          return new Promise((resolveSend, rejectSend) => {\n            event.respondWith = promise => {\n              try {\n                resolveSend(promise);\n              } catch(e) {\n                rejectSend(e);\n              }\n            };\n          });\n        }\n      });\n\n      self.ready();\n    });\n  }\n}\n","/*!\n * A WebApp is a remote application that runs in a WebAppContext.\n *\n * Copyright (c) 2017 Digital Bazaar, Inc. All rights reserved.\n */\n'use strict';\n\nimport {Client} from './Client.js';\nimport {Server} from './Server.js';\nimport {parseUrl} from './utils.js';\n\nexport class WebApp {\n  constructor(relyingOrigin) {\n    // this is the origin that created the WebAppContext to run it in\n    // TODO: better name? `contextOrigin`?\n    this.relyingOrigin = parseUrl(relyingOrigin).origin;\n    this.client = null;\n    this.injector = null;\n    this.client = new Client();\n    this.server = new Server();\n\n    this._control = null;\n    this._connected = false;\n  }\n\n  /**\n   * Connects this WebApp to the relying origin that instantiated it. Once\n   * connected, the WebApp can start servicing calls from that origin.\n   *\n   * @return a Promise that resolves to an injector for creating custom client\n   *           APIs once the connection is ready.\n   */\n  async connect() {\n    this.injector = await this.client.connect(this.relyingOrigin);\n    this._connected = true;\n    this._control = this.injector.define('core.control', {\n      functions: ['ready', 'show', 'hide']\n    });\n    this.server.listen(this.relyingOrigin);\n    return this.injector;\n  }\n\n  /**\n   * Must be called after `connect` when this WebApp is ready to start\n   * receiving calls from the remote end.\n   */\n  async ready() {\n    if(!this._connected) {\n      throw new Error('WebApp not connected. Did you call \".connect()\"?');\n    }\n    await this._control.ready();\n    return this;\n  }\n\n  /**\n   * Closes this WebApp's connection to the relying origin.\n   */\n  close() {\n    if(this._connected) {\n      this.server.close();\n      this.client.close();\n      this._connected = false;\n    }\n  }\n\n  /**\n   * Shows the UI for this WebApp on the relying origin.\n   */\n  async show() {\n    if(!this._connected) {\n      throw new Error(\n        'Cannot \"show\" yet; not connected. Did you call \".connect()\"?');\n    }\n    return this._control.show();\n  }\n\n  /**\n   * Hides the UI for this WebApp on the relying origin.\n   */\n  async hide() {\n    if(!this._connected) {\n      throw new Error(\n        'Cannot \"hide\" yet; not connected. Did you call \".connect()?\"');\n    }\n    return this._control.hide();\n  }\n}\n","/*!\n * Copyright (c) 2018-2022 Digital Bazaar, Inc. All rights reserved.\n */\n/* global navigator */\nimport {CredentialEventProxy} from './CredentialEventProxy.js';\nimport {WebAppContext} from 'web-request-rpc';\n\nconst DEFAULT_MEDIATOR = 'https://authn.io';\n\nexport async function installHandler() {\n  const CredentialManager = navigator.credentialsPolyfill.CredentialManager;\n\n  // site asks permission to be a credential handler for the user\n  const result = await CredentialManager.requestPermission();\n  if(result !== 'granted') {\n    throw new Error('Permission denied.');\n  }\n}\n\n/**\n * Emulates activating a service worker.\n *\n * @param {string} [mediatorOrigin=DEFAULT_MEDIATOR]\n * @param {function} get\n * @param {function} store\n * @returns {Promise}\n */\nexport async function activateHandler({\n  mediatorOrigin = DEFAULT_MEDIATOR, get, store\n}) {\n  if(!(get || store)) {\n    throw new Error('\"get\" or \"store\" function(s) must be specified.');\n  }\n\n  const CredentialHandler = navigator.credentialsPolyfill.CredentialHandler;\n  const self = new CredentialHandler(mediatorOrigin);\n\n  if(get) {\n    if(typeof get !== 'function') {\n      throw new TypeError('\"get\" must be a function.');\n    }\n    self.addEventListener('credentialrequest', event => listener({event, get}));\n  }\n\n  if(store) {\n    if(typeof store !== 'function') {\n      throw new TypeError('\"store\" must be a function.');\n    }\n    self.addEventListener('credentialstore', event => listener({event, store}));\n  }\n\n  await self.connect();\n}\n\nexport async function receiveCredentialEvent() {\n  const proxy = new CredentialEventProxy();\n  return proxy.receive();\n}\n\nfunction listener({event, get, store}) {\n  event.respondWith(createResponse({event, get, store}));\n}\n\nasync function createResponse({event, get, store}) {\n  const result = await (get || store)({event});\n  if(!(result && typeof result === 'object')) {\n    throw new TypeError(\n      'Return value of \"get\" or \"store\" hook must be an object.');\n  }\n\n  if(result.type === 'response') {\n    return {dataType: result.dataType, data: result.data};\n  }\n\n  if(result.type === 'redirect') {\n    // create WebAppContext to run WebApp and connect to windowClient\n    const appContext = new WebAppContext();\n    const handle = await event.openWindow(result.url);\n\n    const windowReady = appContext.createWindow(result.url, {\n      handle,\n      popup: false,\n      // default to 10 minute timeout for loading other window on same site\n      // to allow for authentication pages and similar\n      timeout: 600000\n    });\n\n    // create proxy interface for making calls in WebApp\n    const injector = await windowReady;\n    const proxy = injector.get('credentialEventProxy', {\n      functions: [{name: 'send', options: {timeout: 0}}]\n    });\n\n    // WebApp running in window is ready; proxy event to it and return response\n    return proxy.send({\n      type: event.type,\n      credentialRequestOptions: event.credentialRequestOptions,\n      credentialRequestOrigin: event.credentialRequestOrigin,\n      credential: event.credential,\n      hintKey: event.hintKey\n    });\n  }\n\n  throw new Error(\n    'Return value of \"get\" or \"store\" must have a type of ' +\n    '\"response\" or \"redirect\".');\n}\n"],"sourceRoot":""}